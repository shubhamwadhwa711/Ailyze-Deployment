version: "3.8"
services:
  celery-1:
    container_name: celery-1
    restart: always
    image: ailyzeregistery.azurecr.io/ailyze-backend:${BACKENDTAG}-latest
    environment:
      DB_HOST: ${DB_HOST}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_NAME: ${DB_NAME}
      CELERY_BROKER_URL: ${CELERY_BROKER_URL}
      CELERY_RESULT_BACKEND: ${CELERY_RESULT_BACKEND}
    volumes:
      - ../Ailyze_openai_dajngo/AILYZE:/AILYZE
    env_file:
      - ./.env
    command: celery  -A AILYZE worker -l info --autoscale=10,4 -Q themeandresearchquestion -n theme -Ofair
    depends_on:
      - redis
      - backend-oneclickinsight
    networks:
      ailyze-nw:

  celery-2:
    image: ailyzeregistery.azurecr.io/ailyze-backend:${BACKENDTAG}-latest
    container_name: celery-2
    restart: always
    environment:
      DB_HOST: ${DB_HOST}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_NAME: ${DB_NAME}
      CELERY_BROKER_URL: ${CELERY_BROKER_URL}
      CELERY_RESULT_BACKEND: ${CELERY_RESULT_BACKEND}
    volumes:
      - ../Ailyze_openai_dajngo/AILYZE:/AILYZE
    env_file:
      - ./.env
    command: celery -A AILYZE worker -l info --autoscale=10,4 -Q frequency_analysis -n frequency -Ofair
    depends_on:
      - redis
      - rabbitmq
      - backend-oneclickinsight
    networks:
      ailyze-nw:

  celery-3:
    image: ailyzeregistery.azurecr.io/ailyze-backend:${BACKENDTAG}-latest
    container_name: celery-3
    restart: always
    environment:
      DB_HOST: ${DB_HOST}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_NAME: ${DB_NAME}
      CELERY_BROKER_URL: ${CELERY_BROKER_URL}
      CELERY_RESULT_BACKEND: ${CELERY_RESULT_BACKEND}
    volumes:
      - ../Ailyze_openai_dajngo/AILYZE:/AILYZE
    env_file:
      - ./.env
    command: celery -A AILYZE worker -l info --autoscale=10,4 -Q compareviewpoint -n compare -Ofair
    depends_on:
      - redis
      - rabbitmq
      - backend-oneclickinsight
    networks:
      ailyze-nw:
      

  celery-4:
    image: ailyzeregistery.azurecr.io/ailyze-backend:${BACKENDTAG}-latest
    container_name: celery-4
    restart: always
    environment:
      DB_HOST: ${DB_HOST}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_NAME: ${DB_NAME}
      CELERY_BROKER_URL: ${CELERY_BROKER_URL}
      CELERY_RESULT_BACKEND: ${CELERY_RESULT_BACKEND}
    volumes:
      - ../Ailyze_openai_dajngo/AILYZE:/AILYZE
    env_file:
      - ./.env
    command: celery -A AILYZE worker -l info --autoscale=10,4 -Q prepare_bot -n chatbot -Ofair
    depends_on:
      - redis
      - rabbitmq
      - backend-chatbot
    networks:
      ailyze-nw:
  
  celery-beat:
    image: celery
    container_name: celery_beat
    build:
      context: ../Ailyze_openai_dajngo/AILYZE/
      dockerfile: Dockerfile
    environment:
      DB_HOST: ${DB_HOST}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_NAME: ${DB_NAME}
      CELERY_BROKER_URL: ${CELERY_BROKER_URL}
      CELERY_RESULT_BACKEND: ${CELERY_RESULT_BACKEND}
    volumes:
      - ../Ailyze_openai_dajngo/AILYZE:/AILYZE
    env_file:
      - ./.env
    command: celery -A AILYZE worker -l info -Q celery
    depends_on:
      - redis
      - rabbitmq
      - backend-oneclickinsight
    networks:
      ailyze-nw:

